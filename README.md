# 동시성 제어에대한 처리 방식

## 동시성 문제가 발생하는 경우 
- 같은 사용자의 포인트에대해 변경요청이 동시에 오는경우 동시성으로 인한 문제가 발생한다.
- 서로 다른 사용자에대한 요청은 동시에 오더라도 문제가 되지 않는다.

## 처리 방법
- point를 변경하는 부분을 단순 synchronized로 처리할 경우 서로 다른 사용자에 대한 요청에대해서도 모두 동기적으로 처리되기에 성능 저하가 발생한다
- 유저별로 lock을 두고 이 lock을 이용해 공유자원에 대한 접근을 제어한다.
- lock은 ReentrantLock을 사용하였고 fair 옵션을 true로 주어 공정성 문제를 해결하였다.

# 테스트 방법
## 테스트 환경
- Junit5를 이용했다.
- 동시성에대한 테스트는 Service, Infra layer를 통합하는 통합 테스트로 진행하였다
- Infra layer 의 구현에서 랜덤한 시간을 대기하도록 하여 실제로 동시성 문제가 발생하는지 먼저 확인하였다
## 동시 요청 
- ExecutorService 와 CountDownLatch 를 이용하여 여러 Thread를 동시에 요청하도록 하였다
- 테스트용 Debug 레벨의 로깅을 통해 실제로 요청이 동시에 들어가는것, 그리고 순차적으로 진행되는것을 확인했다
- 테스트 결과로는 공유자원에대한 올바른 변경값으로 검증하였다
